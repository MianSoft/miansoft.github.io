<html>
  <head>
    <!-- 
      ?id=5f9e54b893c350df94c47a06&ar=1656036754073
      ?id=5e7ef588480f046c87d71e6a&ar=0
      ?id=<_id>&ar=<avatar_revision>
      -->
    <title>IO头像</title>
    <script src="pnglib.js"></script>
    <script src="identicon.tetrio.js"></script>
  </head>
  <body>
    <div class="Identicon">
      <script type="text/javascript">
        // 解析地址栏中的参数
        var data;
        var url = new URL(window.location.href);
        var _id = url.searchParams.get("id");
        var ar = url.searchParams.get("ar");
        
        // 解析图像
        var imageSrc = "https://tetr.io/user-content/avatars/" + _id + ".jpg?rv=" + ar;
        var img = new Image();
        img.onload = function() {
          // 图像存在，显示图像
          document.write('<img src="' + imageSrc + '">');
        };
        img.onerror = function() {
          // 图像不存在，则使用Identicon生成图像
          data = new Identicon(MD5(_id), {
            background: [0x08, 0x0A, 0x06, 255],
            margin: 0.15,
            size: 300,
            brightness: 0.48,
            saturation: 0.65,
            format: 'png'
          }).toString();
          document.write('<img src="data:image/png;filename=' + _id +'.png;base64,' + data + '">');
        };
        img.src = imageSrc;
      </script>
    </div>
  </body>
</html>